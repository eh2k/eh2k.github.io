<html>

<body class="dark-mode with-custom-webkit-scrollbars with-custom-css-scrollbars" data-dm-shortcut-enabled="true"
    data-sidebar-shortcut-enabled="true" data-set-preferred-mode-onload="true">

    <div>
        <div>
            <canvas id="display" width="128" height="64"
                style="border:10px solid black; background-color: black;"></canvas>
        </div>

        <p>
            <button id="load" class="button button_round">Load</button>
        </p>

        <script type="module">

            const screenShot = [70, 73, 73, 73, 49, 0, 7, 8, 112, 8, 7, 0, 127, 4, 8, 16, 127, 0, 1, 1, 127, 1, 1, 0, 127, 8, 8, 8, 127, 0, 32, 16, 8, 4, 2, 0, 127, 65, 65, 34, 28, 0, 68, 40, 16, 40, 68, 0, 127, 9, 9, 9, 1, 0, 127, 2, 12, 2, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 28, 62, 62, 62, 28, 28, 62, 62, 62, 28, 28, 34, 34, 34, 28, 28, 34, 34, 34, 28, 1, 1, 1, 1, 129, 129, 65, 65, 65, 65, 65, 129, 129, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 240, 12, 2, 1, 0, 0, 0, 0, 127, 0, 0, 0, 0, 1, 2, 12, 240, 0, 0, 0, 255, 1, 253, 253, 129, 1, 129, 253, 129, 1, 129, 253, 253, 1, 253, 253, 129, 1, 129, 253, 129, 1, 129, 253, 129, 1, 129, 253, 253, 1, 255, 0, 0, 0, 56, 68, 68, 68, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 16, 160, 64, 0, 0, 248, 16, 96, 16, 248, 0, 224, 144, 136, 144, 224, 0, 248, 72, 200, 72, 48, 0, 0, 8, 248, 8, 0, 0, 248, 16, 96, 16, 248, 0, 8, 248, 72, 72, 176, 0, 224, 144, 136, 144, 224, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 6, 8, 16, 32, 32, 64, 64, 64, 64, 64, 32, 32, 16, 8, 6, 1, 0, 0, 0, 63, 32, 47, 32, 47, 32, 47, 47, 47, 32, 47, 47, 47, 32, 47, 47, 47, 32, 47, 47, 47, 32, 47, 47, 47, 32, 47, 47, 47, 32, 63, 0, 0, 0, 7, 4, 4, 31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0, 1, 2, 0, 0, 2, 3, 2, 0, 0, 3, 0, 0, 0, 3, 0, 2, 3, 2, 2, 1, 0, 3, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 64, 32, 32, 160, 32, 32, 64, 128, 0, 0, 0, 0, 0, 0, 0, 0, 128, 128, 128, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 64, 32, 32, 32, 32, 32, 64, 128, 0, 0, 0, 0, 0, 0, 0, 0, 128, 0, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 128, 128, 0, 0, 0, 0, 0, 0, 0, 128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 31, 32, 64, 128, 128, 135, 128, 128, 64, 32, 31, 0, 0, 0, 0, 0, 0, 0, 63, 4, 12, 20, 35, 0, 16, 42, 42, 42, 60, 0, 2, 31, 34, 32, 16, 0, 28, 42, 42, 42, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 31, 32, 64, 144, 136, 132, 128, 128, 64, 32, 31, 0, 0, 0, 0, 0, 0, 0, 63, 4, 4, 4, 63, 0, 28, 34, 34, 34, 28, 0, 0, 32, 63, 32, 0, 0, 28, 34, 34, 36, 63, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 144, 240];

            async function readFile(file) {
                let result = await new Promise((resolve) => {
                    let fileReader = new FileReader();
                    fileReader.onload = (e) => resolve(fileReader.result);
                    fileReader.readAsArrayBuffer(file);
                });

                return result;
            }

            const canvas = document.getElementById("display")
            const canvas128x64 = canvas.cloneNode();
            const context128x64 = canvas128x64.getContext("2d")
            const context2d = canvas.getContext("2d")
            const ZOOM = 5
            canvas.width *= ZOOM
            canvas.height *= ZOOM
            context2d.imageSmoothingEnabled = false;

            const imgBuffer = context128x64.getImageData(0, 0, 128 * ZOOM, 64 * ZOOM);

            async function drawScreen(buffer) {
                function getPixel(x, y) {
                    return buffer[x + Math.floor(y / 8) * 128] & (1 << (y & 7))
                }

                for (let y = 0; y < 64; y++)
                    for (let x = 0; x < 128; x++) {
                        const pixel = getPixel(x, y) ? 255 : 0;
                        const i = 4 * (y * imgBuffer.width + x)

                        imgBuffer.data[i + 0] = pixel;
                        imgBuffer.data[i + 1] = pixel;
                        imgBuffer.data[i + 2] = pixel;
                        imgBuffer.data[i + 3] = 255; //alpha
                    }

                context128x64.putImageData(imgBuffer, 0, 0)
                context2d.drawImage(canvas128x64, 0, 0, 128 * ZOOM, 64 * ZOOM)
            }

            drawScreen(new Uint8Array(screenShot))

            document.getElementById("load").onclick = function () {
                return new Promise((resolve) => {
                    let input = document.createElement('input');
                    input.type = 'file';
                    input.accept = "*.bin"
                    input.multiple = false
                    input.onchange = async () => {

                        if (!input.files[0]) {
                            resolve(false);
                            return;
                        }

                        for (const file of input.files) {
                            const buffer = await readFile(file);
                            console.log(buffer)
                            drawScreen(buffer)
                        }

                        resolve(true);
                    };
                    input.click();
                });
            }

        </script>
    </div>
</body>

</html>